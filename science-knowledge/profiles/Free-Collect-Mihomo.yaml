# 
mixed-port: 7890
allow-lan: false   # 局域网覆盖，连接同一个网络，将其它设备的网络代理指向开启 clash 设备的 IP 及代理端口
bind-address: "*"  # 局域网覆盖的地址，* 表示所有
mode: rule
log-level: info
ipv6: false
external-controller: 127.0.0.1:9090

dns:
  enabled: true
  listen: 0.0.0.0:1053
  ipv6: false
  default-nameserver:            # DNS servers, 仅 Do53 协议，即：纯 IP 
    - 1.1.1.1                    # Cloudflare 
    - 8.8.8.8                    # google 
  enhanced-mode: fake-ip         # 默认 fake-ip
  fake-ip-range: 198.18.0.1/16   # Fake IP addresses pool CIDR
  fake-ip-filter:                # 对以下 IP 不返回 fake IP，返回真实 IP
    - '*.lan'
    - '*.msftconnecttest.com'


proxies:  # ↓ 死灰复燃 ↓


# 策略组
proxy-groups:

  - name: SELECT-PROXY
    type: select
    include-all-proxies: true
    proxies:
      - 负载均衡
      - 手动选择
      - 美国
      - 香港
      - 新加坡
      - 日本
      - ChatGPT
      - Gemini
      - GitHub
      - YouTube
      - Telegram
      - Bing
      - Microsoft

  - name: 负载均衡
    type: load-balance
    url: 'https://www.gstatic.com/generate_204'  # 范性策略组，应只检查测速是否可达，而不检查对某个地址是否可用（状态码返回 200）
    interval: 300
    strategy: consistent-hashing
    include-all-providers: true

  - name: 手动选择
    type: select
    url: 'https://www.gstatic.com/generate_204'
    interval: 300
    include-all-providers: true

  - name: 美国
    type: select
    url: 'https://www.gstatic.com/generate_204'
    interval: 300
    include-all-providers: true
    filter: (?i)美|波特兰|达拉斯|俄勒冈|凤凰城|费利蒙|硅谷|拉斯维加斯|洛杉矶|圣何塞|圣克拉拉|西雅图|芝加哥|US|United States

  - name: 香港
    type: select
    url: 'https://www.gstatic.com/generate_204'
    interval: 300
    include-all-providers: true
    filter: (?i)港|HK|hk|Hong Kong|HongKong|hongkong

  - name: 新加坡
    type: select
    url: 'https://www.gstatic.com/generate_204'
    interval: 300
    include-all-providers: true
    filter: (?i)新加坡|坡|狮城|SG|Singapore

  - name: 日本
    type: select
    url: 'https://www.gstatic.com/generate_204'
    interval: 300
    include-all-providers: true
    filter: (?i)日本|川日|东京|大阪|泉日|埼玉|沪日|深日|JP|Japan

  - name: ChatGPT
    type: select
    url: 'https://auth.openai.com/log-in'  # 只有明确了目标地址才应该使用相关测速地址，并检查测速状态
    interval: 300
    expected-status: 200-302
    header:
      User-Agent: ['Mozilla/5.0 (Windows NT 10.0; Win64; x64)']
    include-all-providers: true

  - name: Gemini
    type: select
    url: 'https://gemini.google.com/'
    interval: 300
    expected-status: 200-302
    header:
      User-Agent: ['Mozilla/5.0 (Windows NT 10.0; Win64; x64)']
    include-all-providers: true

  - name: GitHub
    type: select
    url: 'https://github.com/'
    interval: 300
    expected-status: 200-302
    include-all-providers: true

  - name: YouTube
    type: select
    url: 'https://www.youtube.com/'
    interval: 300
    expected-status: 200-302
    include-all-providers: true

  - name: Telegram
    type: select
    url: 'https://telegram.org/'
    interval: 300
    expected-status: 200-302
    include-all-providers: true

  - name: Bing
    type: select
    url: 'https://www.bing.com/'
    interval: 300
    expected-status: 200-302
    include-all-providers: true

  - name: Microsoft
    type: select
    url: 'https://www.microsoft.com/'
    interval: 300
    expected-status: 200-302
    include-all-providers: true


# 代理供应商
proxy-providers:

  # example:
  #   type: http
  #   url: https://example/clash.yml
  #   path: ./providers/proxy/example.yaml
  #   interval: 21600
  #   health-check:
  #     enable: false  # 不进行健康检查
  #     interval: 300
  #     url: https://www.gstatic.com/generate_204  # 保留健康检查是因为，当策略组（proxy-groups）未配置 url 时能使用此 url


rule-providers:

  reject-custom: # 自定义黑名单，大范围匹配时使用
    type: http
    behavior: classical
    url: https://url-transfer.deno.dev/?content=JZmq%2FQnsjyCuB1j%2Bb43c1g%3D%3D%2CnHUHLY90v%2F%2BY9eKuFMalNXrIQB7Ot5tqNDH6WTNqS8zYJTO3hP4QwSoU7vV58RW%2B%2B0vP9gEwD%2BTAT%2FU16C2inwiLQvhrztFPOCmsdGKW3XzT5m0EXTRIzdy1htOOiE%2BwEAlAmn%2BOG%2BNSFp6ae2ElHWG5RLMU%2FQqNYHNRLK7i%2BgSjVSxuzC%2FVUw%3D%3D
    path: ./ruleset/reject-custom.yaml
  proxy-custom: # 自定义代理
    type: http
    behavior: classical
    url: https://url-transfer.deno.dev/?content=HiCjMuooW2gmtuiOtXX8PA%3D%3D%2C7zoNAZkyV5boaUE%2FFgcq0rWG%2BzgTOD1criNyJhYBca7VjvtgfMY0k631hFQuU64nEuJofJab6uHo5HMjc4tqTgI%2BUuVatcCa8d9lPiQa5Sz1sL6ZrXh%2Bny9Fn21A%2BwiewusWu8bc7a4LQm%2F018y0KR4PB5%2F%2Fou3LR0liSB%2F8nPu%2BoDd%2FdFKr
    path: ./ruleset/proxy-custom.yaml
  direct-custom: # 自定义直连
    type: http
    behavior: classical
    url: https://url-transfer.deno.dev/?content=p7IAvqO9%2F7Ci69MlFgkM3A%3D%3D%2Cx2QE4ADC5biByKFHecCxzvVF8Y309XnGAt2zC0yx3Lo6MowTzYJ%2FBqBqHOEZTXjegoqJUtYkICpPI6D9DUj6UUfZF3tbI8NChO3Ns2XaIYB7PV3gdrfdBzk57xCu7%2BRz6%2F0TMUB9cyBtPOASpQFg0d%2FXDjtqk2QFnpt6%2F7ts%2FuftrdGsU0hkOg%3D%3D
    path: ./ruleset/direct-custom.yaml

  # 调用第三方规则
  # 直连
  direct:
    type: http
    behavior: domain
    url: https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/direct.txt
    path: ./ruleset/direct.yaml
  # 广告
  reject:
    type: http
    behavior: domain
    url: https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/reject.txt
    path: ./ruleset/reject.yaml
  # 私有专用域名，如：路由器登录
  private:
    type: http
    behavior: domain
    url: https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/private.txt
    path: ./ruleset/private.yaml
  # 中国大陆域名，国外服务器 IP 地址列表
  cncidr:
    type: http
    behavior: ipcidr
    url: https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/cncidr.txt
    path: ./ruleset/cncidr.yaml


rules:

  - DOMAIN,yacd.haishan.me,DIRECT # Clash 调试页面
  - DOMAIN,clash.razord.top,DIRECT # Clash 调试页面
  - DOMAIN-SUFFIX,deno.dev,SELECT-PROXY # 节点更新走代理

  ## 自定义规则
  - RULE-SET,reject-custom,REJECT
  - RULE-SET,proxy-custom,SELECT-PROXY
  - RULE-SET,direct-custom,DIRECT

  ## 公开库
  - RULE-SET,reject,REJECT
  - RULE-SET,private,DIRECT
  - RULE-SET,direct,DIRECT
  - RULE-SET,cncidr,DIRECT,no-resolve

  - GEOIP,LAN,DIRECT,no-resolve  # 局域网走直连
  - GEOIP,CN,DIRECT,no-resolve   # 国内地址走直连

  - MATCH,SELECT-PROXY
